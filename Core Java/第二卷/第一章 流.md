> Javaçš„Stream APIå’Œé›†åˆï¼ˆCollectionï¼‰éƒ½å¯ä»¥ç”¨äºæ“ä½œæ•°æ®ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ï¼Œä½¿å¾—åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨Streamä¼šæ¯”ä½¿ç”¨é›†åˆæ›´æœ‰ä¼˜åŠ¿ï¼š 
>
> - å¹¶è¡Œå¤„ç†ï¼šStream APIæ”¯æŒå¹¶è¡Œå¤„ç†ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„ä¼˜åŠ¿æ¥å¤„ç†å¤§é‡æ•°æ®ã€‚è¿™å¯¹äºå¤„ç†å¤§æ•°æ®é›†æ—¶å¯ä»¥å¤§å¤§æé«˜æ€§èƒ½ã€‚ 
> - å‡½æ•°å¼ç¼–ç¨‹ï¼šStream APIæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨å£°æ˜æ€§ä»£ç æ¥å¤„ç†æ•°æ®ã€‚è¿™å¯ä»¥ä½¿ä½ çš„ä»£ç æ›´ç®€æ´ï¼Œæ›´æ˜“è¯»ï¼Œæ›´æ˜“äºç»´æŠ¤ã€‚ 
> - æƒ°æ€§æ‰§è¡Œï¼šStream APIçš„è®¸å¤šæ“ä½œæ˜¯æƒ°æ€§çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åªæœ‰åœ¨éœ€è¦ç»“æœæ—¶æ‰ä¼šæ‰§è¡Œã€‚è¿™å¯ä»¥å¸®åŠ©ä½ ä¼˜åŒ–æ€§èƒ½ï¼Œå› ä¸ºä½ å¯ä»¥é¿å…å¯¹æ•°æ®è¿›è¡Œä¸å¿…è¦çš„å¤„ç†ã€‚ 
> - é“¾å¼æ“ä½œï¼šStream APIæ”¯æŒé“¾å¼æ“ä½œï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥å°†å¤šä¸ªæ“ä½œé“¾æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªæ“ä½œç®¡é“ã€‚è¿™å¯ä»¥ä½¿ä½ çš„ä»£ç æ›´ç®€æ´ï¼Œæ›´æ˜“è¯»ã€‚ 
> - æ— å‰¯ä½œç”¨ï¼šStreamæ“ä½œä¸ä¼šä¿®æ”¹å…¶æºï¼Œå› æ­¤å®ƒä»¬æ²¡æœ‰å‰¯ä½œç”¨ã€‚è¿™ä½¿å¾—ä½ çš„ä»£ç æ›´æ˜“äºç†è§£å’Œæµ‹è¯•ã€‚ 
> - ä¼˜åŒ–çš„ç‰¹å®šæ“ä½œï¼šStream APIæä¾›äº†ä¸€äº›ä¼˜åŒ–çš„æ“ä½œï¼Œå¦‚reduceï¼Œcollectï¼ŒflatMapç­‰ï¼Œè¿™äº›åœ¨é›†åˆAPIä¸­ä¸å¯ç”¨æˆ–ä½¿ç”¨èµ·æ¥ä¸æ–¹ä¾¿

# 1.1 ä»è¿­ä»£åˆ°æµ

è¿­ä»£æ–¹å¼è¿›è¡Œå¶æ•°ç»Ÿè®¡

```java
public static void è¿­ä»£éå†() {
    int count = 0;
    for(var it:list){
        if(it % 2 == 0){
            count++;
        }
    }
    System.out.println(count);
}
```

ç­‰ä»·äºæµçš„å¦‚ä¸‹å†™æ³•

```java
public static void æµéå†() {
    long count = list.stream().filter(it -> it % 2 == 0).count();
    System.out.println(count);
}
```

æµè¿˜æœ‰å¹¶è¡Œçš„å¤„ç†æ–¹å¼

```java
public static void å¹¶è¡Œæµéå†2() {
    long count = list.parallelStream().filter(it -> it % 2 == 0).count();
    System.out.println(count);
}
```

æµéµå¾ªäº†`åšä»€ä¹ˆè€Œéæ€ä¹ˆåš`ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‡å®šå®ƒçš„æ‰§è¡Œé¡ºåºæˆ–è€…åœ¨å“ªä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚

æµå’Œé›†åˆè¡¨é¢çœ‹èµ·æ¥å¾ˆåƒï¼Œä½†æ˜¯å¥¹ä»¬å­˜åœ¨æ˜¾è‘—çš„å·®è·ã€‚

1. `æµå¹¶ä¸å­˜å‚¨å…ƒç´ `ã€‚å…ƒç´ å¯èƒ½å‚¨å­˜åœ¨åº•å±‚çš„é›†åˆä¸­ï¼Œæˆ–è€…æŒ‰éœ€ç”Ÿæˆã€‚
2. `æµçš„æ“ä½œä¸ä¼šä¿®æ”¹æ•°æ®æºã€‚`ä¾‹å¦‚filterä¸ä¼šä»æµç§»é™¤å…ƒç´ ï¼Œè€Œæ˜¯ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æµã€‚
3. `æµçš„æ“ä½œæ˜¯å°½å¯èƒ½æƒ°æ€§æ‰§è¡Œçš„ã€‚`è¿™æ„å‘³è¿™ç›´è‡³éœ€è¦å…¶ç»“æœæ˜¯ï¼Œæ“ä½œæ‰ä¼šæ‰§è¡Œã€‚ä¾‹å¦‚æˆ‘ä»¬åªæƒ³æŸ¥æ‰¾å‰äº”ä¸ªé•¿å•è¯ï¼Œé‚£ä¹ˆfilteråœ¨ç¬¬äº”ä¸ªå•è¯ä¹‹åå°±ä¼šåœæ­¢è¿‡æ»¤ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ“çºµæ— é™æµ

åœ¨ä¸Šè¿°æµçš„ç¤ºä¾‹ä¸­ã€‚æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªé˜¶æ®µçš„æ“ä½œç®¡é“ã€‚

1. åˆ›å»ºä¸€ä¸ªæµ
2. æŒ‡å®šå°†åˆå§‹æµè½¬æ¢ä¸ºå…¶å®ƒæµçš„ä¸­é—´æ“ä½œï¼Œå¯èƒ½æœ‰å¤šä¸ªæ­¥éª¤
3. åº”ç”¨ç»ˆæ­¢æ“ä½œï¼Œä»è€Œäº§ç”Ÿç»“æœã€‚è¿™ä¸ªæ“ä½œä¼šå¼ºåˆ¶æ‰§è¡Œä¹‹å‰çš„æƒ°æ€§æ“ä½œï¼Œä¹‹åæµå°†ä¸å¯ç”¨

# 1.2 æµçš„åˆ›å»º

ä»¥ä¸‹æ˜¯æµçš„ä¸€äº›åˆ›å»ºæ–¹æ³•

```java
private static void åˆ›å»ºæµ(){
    var list = List.of(1, 2, 3, 4, 5);
    // 1. ç”±æ•°å€¼ç›´æ¥æ„å»ºæµ
    var stream = Stream.of(1, 2, 3, 4, 5);
    // 2. ç”±æ•°ç»„æ„å»ºæµ
    var stream1 = Stream.of(new int[]{1, 2, 3, 4, 5});
    // 3. ç”±é›†åˆæ„å»ºæµ
    var stream3 = list.stream();
    var stream4 = list.parallelStream();
    // 4. ç”±å‡½æ•°ç”Ÿæˆæµ
    var stream5 = Stream.generate(Math::random);
}
```

å¦‚æœæƒ³äº§ç”Ÿ0,2,4,6,8â€¦â€¦è¿™æ ·çš„é›†åˆï¼Œå¯ä»¥ä½¿ç”¨`iterate`æ–¹æ³•

```java
private static void iterateåˆ›å»ºç­‰å·®æ•°åˆ—(){
    // ç”Ÿæˆä¸€ä¸ªç­‰å·®æ•°åˆ—
    Stream.iterate(0, n ->n.compareTo(10) < 0,n -> n + 2)
        .forEach(System.out::println);
}
```

ç¬¬äºŒä¸ªå‚æ•°ä¸€æ—¦æ‹’ç»äº†æŸæ¬¡è¿­ä»£äº§ç”Ÿçš„å€¼ï¼Œè¿™ä¸ªæµå°±ç»“æŸã€‚

`Stream.ofNullable`æ–¹æ³•ä¼šç”¨ä¸€ä¸ªå¯¹è±¡åˆ›å»ºä¸€ä¸ªéå¸¸çŸ­çš„æµã€‚

è‹¥è¯¥å¯¹è±¡ä¸º`null`,åˆ™æµçš„é•¿åº¦ä¸º0ã€‚

å¦åˆ™æµçš„é•¿åº¦ä¸º1,å…¶ä¸­ä»…åŒ…å«è¯¥å¯¹è±¡ã€‚

```java
private static void ofNullableæ–¹æ³•(){
    Object obj = new Object();
    // ç”Ÿæˆä¸€ä¸ªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„æµ
    Stream<Object> stream1 = Stream.ofNullable(obj);
    stream1.forEach(System.out::println);
    // ç”Ÿæˆä¸€ä¸ªç©ºæµ
    obj = null;
    Stream<Object> stream2 = Stream.ofNullable(obj);
    stream2.forEach(System.out::println);
}
```

æ‰“å°ç»“æœä¸º

```java
java.lang.Object@7ba4f24f
```

ä»…ä»…æ‰“å°äº†ä¸€æ¬¡å†…å®¹ã€‚

`toList`æ–¹æ³•å¯ä»¥è®©å…¶æœ€ç»ˆç»“æœè½¬ä¸ºList

```java
private static void toListæ–¹æ³•(){
    // ç”Ÿæˆä¸€ä¸ªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„æµ
    Stream<Object> stream = Stream.of(1,2,3,4,5);
    List<Object> list = stream.toList();
    System.out.println(list);
}
```

# 1.3 filterã€mapå’ŒflatMapæ–¹æ³•

`filter`çš„å¼•å…ƒæ˜¯ä¸€ä¸ª`Predicate<T>`ç±»å‹çš„å¯¹è±¡ï¼Œå³ä»Tæ˜ å°„åˆ°booleanå€¼çš„å‡½æ•°ã€‚

æˆ‘ä»¬å¯ä»¥ç”¨å®ƒå°†ä¸€ä¸ªæµçš„å†…å®¹è¿‡æ»¤åˆ°å¦ä¸€ä¸ªæµ

```java
private static void filteræ–¹æ³•(){
    var list = List.of(1, 2, 3, 4, 5);
    // è¿‡æ»¤å‡ºå¶æ•°
    list.stream().filter(it -> it % 2 == 0).forEach(System.out::println);
}
```

`map`æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬æŒ‰ç…§æŸç§æ–¹å¼è½¬æ¢æµä¸­çš„å€¼

```java
private static void mapæ–¹æ³•(){
    var list = List.of(1, 2, 3, 4, 5);
    // å°†æ¯ä¸ªå…ƒç´ ä¹˜ä»¥2
    list.stream().map(it -> it * 2).forEach(System.out::println);
}
```

`flatMap`å¯ä»¥è®©å…¶æ‘Šå¹³å¤šä¸ªæµã€‚å‡è®¾æˆ‘ä»¬æ‰‹ä¸­æœ‰ä¸€ä¸ªæœ‰å¤šä¸ªåˆ—è¡¨çš„åˆ—è¡¨

é‚£ä¹ˆæˆ‘ä»¬æƒ³è¦å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæµï¼Œä¾¿å¯ä»¥ä½¿ç”¨`flatMap`

```java
private static void flatMapæ–¹æ³•(){
    var list = List.of(List.of(1, 2), List.of(3, 4), List.of(5, 6));
    // å°†å¤šä¸ªListåˆå¹¶æˆä¸€ä¸ªList
    list.stream().flatMap(List::stream).forEach(System.out::println);
}
```

å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªæ˜ å°„å‡½æ•°ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªä»»æ„çš„ç»“æœæˆ–å¤šä¸ªç»“æœã€‚

è€ƒè™‘å¦‚ä¸‹ç¤ºä¾‹ï¼Œ`codePoints`æ–¹æ³•ä¼šäº§ç”Ÿä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰`ç¼–ç ç‚¹`ã€‚

ä¾‹å¦‚`codePoints("Hello ğŸŒ")`è¿”å›æµç”±æ¯ä¸ªå­—ç¬¦æ„æˆï¼Œä½†æ˜¯ğŸŒç”±ä¸¤ä¸ªcharå€¼æ„æˆã€‚

æ‰€ä»¥æˆ‘ä»¬è¦é‡‡ç”¨ä¸åŒçš„æ–¹å¼å¤„ç†å®ƒä»¬ã€‚

è®©æ–¹æ³•è¿”å›`Stream<String>`å¯¹è±¡

```java
private static Stream<String> codePointsç¤ºä¾‹1(String str){
    return str.codePoints().mapToObj(it -> new String(new int[]{it}, 0, 1));
}
```

é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨`codePoints()`è·å–ç”±æ•´æ•°ç¼–ç ç‚¹æ„æˆçš„æµï¼Œç„¶åè®©ä»–ä»¬æ ¹æ®æ•°ç»„ä¸­çš„å…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚

å½“ä½¿ç”¨`flatMap`æ—¶å€™ï¼Œéœ€è¦æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒä¼šä¸ºæ¯ä¸€ä¸ªæµå…ƒç´ äº§ç”Ÿä¸€ä¸ªæ–°çš„æµã€‚

è¿™ä¼šæ˜¾å¾—å¾ˆå†—é•¿ï¼Œè€Œä¸”æ•ˆç‡ä½ä¸‹ã€‚

`mapMulti`æ–¹æ³•æä¾›äº†å¦ä¸€ç§é€‰æ‹©ã€‚

`mapMulti`æ–¹æ³•æ¥å—ä¸€ä¸ª`BiConsumer`ï¼Œè¿™ä¸ª`BiConsumer`æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šæµä¸­çš„`å½“å‰å…ƒç´ `å’Œä¸€ä¸ª`Consumer`ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªConsumeræ¥æäº¤ä½ æƒ³è¦æ·»åŠ åˆ°ç»“æœæµä¸­çš„å…ƒç´ ã€‚ 

`flatMap`æ–¹æ³•ä¸­çš„ä¾‹å­ä¿®æ”¹åå¦‚ä¸‹ã€‚

```java
private static void mapMultiæ–¹æ³•() {
    var list = List.of(List.of(1, 2), List.of(3, 4), List.of(5, 6));
    // å°†æ¯ä¸ªListçš„å…ƒç´ ä¹˜ä»¥2
    list.stream()
        .mapMulti((it, consumer) -> it.forEach(e -> consumer.accept(e * 2)))
        .forEach(System.out::println);
}
```

# 1.4 æŠ½å–å­æµå’Œç»„åˆæµ

è°ƒç”¨`stream.limit(n)`ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æµï¼Œå®ƒåœ¨nä¸ªå…ƒç´ åç»“æŸï¼Œè¿™å¯¹äºè£å‰ªæ— é™æµå¾ˆæœ‰ç”¨ã€‚

```java
private static void limitæ–¹æ³•() {
    Stream.generate(Math::random)
        .limit(100)
        .forEach(s -> System.out.print(String.format("%.2f ", s) + " "));
}
```

`skip(n)`æ–¹æ³•æ­£å¥½ç›¸åï¼Œå®ƒä¼šè·³è¿‡å‰nä¸ªå…ƒç´ ã€‚

```java
private static void skipæ–¹æ³•() {
    var list = List.of(2,3,4,5,6);
    list.stream().skip(2).forEach(it -> System.out.print(it + " "));
}
```

`takeWhile`ä¼šè·å–ç¬¬ä¸€ä¸ªè°“è¯ä¸ºçœŸçš„å…ƒç´ åŠä¹‹åçš„å…ƒç´ ç»„æˆçš„æµã€‚

```java
private static void takeWhileæ–¹æ³•(){
    var list = List.of(2,3,4,5,6);
    list.stream().takeWhile(it -> it < 5).forEach(it -> System.out.print(it + " "));
    System.out.println();
}
```

æ‰“å°å†…å®¹ä¸º

> `2 3 4`

`dropWhile`ä¼šè·å–ç¬¬ä¸€ä¸ªè°“è¯ä¸ºå‡çš„å…ƒç´ åŠä¹‹åçš„å…ƒç´ ç»„æˆçš„æµã€‚

```java
private static void dropWhileæ–¹æ³•(){
    var list = List.of(2,3,4,5,6);
    list.stream().dropWhile(it -> it > 5).forEach(it -> System.out.print(it + " "));
    System.out.println();
}
```

æ‰“å°å†…å®¹ä¸º

> `2 3 4 5 6`

`concat`å¯ä»¥ç»„åˆä¸¤ä¸ªæµ

```java
private static void concatæ–¹æ³•(){
    var list = List.of(2,3,4,5,6);
    Stream<Integer> stream1 = list.stream().dropWhile(it -> it > 5);
    Stream<Integer> stream2 = list.stream().takeWhile(it -> it < 5);
    Stream.concat(stream1, stream2).forEach(it -> System.out.print(it + " "));
    System.out.println();
}
```

æ‰“å°å†…å®¹ä¸º

> `2 3 4 5 6 2 3 4 `

# 1.5 å…¶ä»–çš„æµè½¬æ¢

`distinct`ä¼šè¿”å›ä¸€ä¸ªå»é™¤é‡å¤å…ƒç´ çš„æµ

```java
private static void distinctæ–¹æ³•(){
    // å»é‡
    var list = List.of(1, 2, 3, 4, 5, 1, 2, 3, 4, 5);
    list.stream().distinct().forEach(it -> System.out.print(it + " "));
    System.out.println();
}

```
è¾“å‡ºç»“æœ
> `1 2 3 4 5 `

å¯¹äºæµçš„æ’åºï¼Œæœ‰å¤šç§`sorted`æ–¹æ³•çš„å˜ä½“å¯ç”¨ã€‚

å…¶ä¸­ä¸€ç§ç”¨äºæ“ä½œ`Compartable`å…ƒç´ çš„æµï¼Œè€Œå¦ä¸€ç§å¯ä»¥æ¥å—`Comparator`

```java
private static void sortedæ–¹æ³•(){
    var list = List.of("233","123","456","78239","123","Wwh","Wwh","Tom","LiHUa","LOLOLOLO");
    list.stream().sorted(Comparator.comparingInt(String::length)).forEach(it -> System.out.print(it + " "));
    System.out.println();
    list.stream().sorted(String::compareTo).forEach(it -> System.out.print(it + " "));
    System.out.println();
}
```

è¾“å‡ºç»“æœä¸º

> `233 123 456 123 Wwh Wwh Tom 78239 LiHUa LOLOLOLO 
> 123 123 233 456 78239 LOLOLOLO LiHUa Tom Wwh Wwh `

`peek`ä¼šäº§ç”Ÿå¦ä¸€ä¸ªæµï¼Œå®ƒçš„å…ƒç´ ä¸åŸæ¥çš„æµä¸­çš„å…ƒç´ ç›¸åŒï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è·å–ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œæ–¹ä¾¿è°ƒè¯•

```java
private static void peekæ–¹æ³•(){
    // peekæ–¹æ³•ç”¨äºè°ƒè¯•
    Stream.iterate(1, it -> it + 1)
        .peek(it -> System.out.print(it + " "))
        .limit(10)
        .count();
    System.out.println();
}
```

ç”±äºpeekæ˜¯æƒ°æ€§æ–¹æ³•ï¼Œæ‰€ä»¥æ–¹æ³•æœ€åéœ€è¦æ·»åŠ ç»ˆç«¯æ“ä½œå¦åˆ™å®ƒä¸ä¼šæ‰§è¡Œã€‚

è¾“å‡ºç»“æœä¸º

> 1 2 3 4 5 6 7 8 9 10 

# 1.6 ç®€å•çº¦ç®€

çº¦ç®€(reduction)æ˜¯ä¸€ç§ç»ˆç»“æ“ä½œï¼Œå®ƒä»¬ä¼šå°†æµçº¦ç®€ä¸ºå¯ä»¥åœ¨ç¨‹åºä¸­ä½¿ç”¨çš„éæµå€¼ã€‚

ä¸Šé¢æˆ‘ä»¬å¯ä»¥è§åˆ°å…¶ä¸­ä¸€ç§çº¦ç®€ï¼Œ`count`ã€‚

å…¶ä»–ç®€å•çº¦ç®€è¿˜æœ‰`max`å’Œ`min`ã€‚

è¿™ä¸¤ç§æ–¹å¼çš„è¿”å›å€¼æ˜¯`Optional<T>`ï¼Œå®ƒè¦ä¹ˆåœ¨å…¶ä¸­åŒ…è£…äº†ç­”æ¡ˆï¼Œè¦ä¹ˆè¡¨ç¤ºæ²¡æœ‰ä»»ä½•å€¼ã€‚

ä»¥ä¸‹æ˜¯è¿™ä¸¤ç§æ–¹å¼çš„ç¤ºä¾‹

```java
private static void maxå’Œmin(){
    var list = List.of(0, 1, 2, 3, 4, 5, 6, 7, 8, 9);
    Optional<Integer> max = list.stream().max(Integer::compareTo);
    System.out.println(max.orElse(0));
    Optional<Integer> min = list.stream().min(Integer::compareTo);
    System.out.println(min.orElse(0));
}
```

æ‰“å°ç»“æœä¸ºï¼š

> 9
>
> 0

`findFirst`è¿”å›çš„æ˜¯éç©ºé›†åˆä¸­çš„ç¬¬ä¸€ä¸ªå€¼ã€‚å¦‚æœæƒ³æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨`filter`å’Œ`findFirst`æ­é…ä½¿ç”¨

```java
private static void findFirstæ–¹æ³•(){
    var list = List.of("wwh", "Tom", "LiHua", "Wwh", "Wwh", "Tom", "Tom", "Tom","MC");
    Optional<String> first = list.stream().filter(it -> it.length() > 3).findFirst();
    System.out.println(first.orElse("Not Found"));
}
```

æ‰“å°ç»“æœä¸ºï¼š

> LiHua

å¦‚æœä¸å¼ºè°ƒç¬¬ä¸€ä¸ªåŒ¹é…ï¼Œè€Œæ˜¯ä½¿ç”¨ä»»æ„åŒ¹é…éƒ½å¯ä»¥ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨`findAny`æ–¹æ³•ã€‚

è¿™ä¸ªæ–¹æ³•åœ¨å¹¶è¡Œæµå¤„ç†æ—¶å¾ˆæœ‰ï¼Œå› ä¸ºæµå¯ä»¥æŠ¥å‘Šä»»ä½•å®ƒæ‰¾åˆ°çš„åŒ¹é…è€Œä¸æ˜¯è¢«é™åˆ¶ä¸ºå¿…é¡»æŠ¥å‘Šç¬¬ä¸€ä¸ªåŒ¹é…ã€‚

```java
private static void findAnyæ–¹æ³•(){
    var list = List.of("wwh", "Tom", "LiHua", "Wwh", "Wwh", "Tom", "Tom", "Tom","MC");
    Optional<String> any = list.stream().parallel().filter(it -> it.length() < 3).findAny();
    System.out.println(any.orElse("Not Found"));
}
```

å¦‚æœæƒ³çŸ¥é“æ˜¯å¦åŒ¹é…å¯ä»¥ä½¿ç”¨`anyMatch`,è¿™ä¸ªæ–¹æ³•ä¼šæ¥å—ä¸€ä¸ªè°“è¯å¼•å…ƒï¼Œå› æ­¤ä¸éœ€è¦ä½¿ç”¨`filter`

```java
private static void anyMatchæ–¹æ³•(){
    var array = Stream.generate(() -> random.nextInt(100))
        .limit(100000000).toArray(Integer[]::new);
    LocalDateTime start = LocalDateTime.now();
    boolean b = Arrays.stream(array).anyMatch(it -> it.equals(99999999));
    LocalDateTime end = LocalDateTime.now();
    System.out.println("99999999 " + (b ? "å­˜åœ¨äºæ•°ç»„ä¸­" : "ä¸å­˜åœ¨äºæ•°ç»„ä¸­") +
                       " è€—æ—¶ï¼š" + ChronoUnit.MILLIS.between(start, end) + "ms");
    start = LocalDateTime.now();
    b = Arrays.stream(array).parallel().anyMatch(it -> it.equals(99999999));
    end = LocalDateTime.now();
    System.out.println("99999999 " + (b ? "å­˜åœ¨äºæ•°ç»„ä¸­" : "ä¸å­˜åœ¨äºæ•°ç»„ä¸­") +
                       " è€—æ—¶ï¼š" + ChronoUnit.MILLIS.between(start, end) + "ms");
}
```

`anyMatch`é…åˆå¹¶è¡Œæµå¤§å¤§æé«˜äº†è¿è¡Œçš„é€Ÿåº¦ï¼ŒåŒæ ·çš„è¦æ±‚ï¼Œå¹¶è¡Œæµå¯ä»¥è¾¾åˆ°ä¸‰å€ä»¥ä¸Šçš„é€Ÿåº¦ã€‚

> 99999999 ä¸å­˜åœ¨äºæ•°ç»„ä¸­ è€—æ—¶ï¼š289ms
> 99999999 ä¸å­˜åœ¨äºæ•°ç»„ä¸­ è€—æ—¶ï¼š56ms

ç›¸ä¼¼çš„è¿˜æœ‰`allMatch`å’Œ`noneMatch`ï¼Œå®ƒä»¬åˆ†åˆ«åœ¨æ‰€æœ‰å…ƒç´ å’Œæ²¡æœ‰å…ƒç´ åŒ¹é…è°“è¯çš„æƒ…å†µä¸‹è¿”å›`true`

# 1.7 Optionalç±»å‹

`Optional<T>`å¯¹è±¡æ˜¯ä¸€ç§åŒ…è£…å™¨å¯¹è±¡ï¼Œè¦ä¹ˆåŒ…è£…äº†ç±»å‹`T`çš„å¯¹è±¡ï¼Œè¦ä¹ˆæ²¡æœ‰åŒ…è£…ä»»ä½•å¯¹è±¡ã€‚

ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç§°å€¼æ˜¯å­˜åœ¨çš„ã€‚

`Optional<T>`ç±»å‹è¢«å½“ä½œä¸€ç§æ›´å®‰å…¨çš„æ–¹å¼æ¥æ›¿ä»£`T`çš„å¼•ç”¨ï¼Œè¿™ç§å¼•ç”¨è¦ä¹ˆå¼•ç”¨æŸä¸ªå¯¹è±¡ï¼Œè¦ä¹ˆä¸º`null`ã€‚

## 1.7.1 è·å–Optionalå€¼

æœ‰æ•ˆåœ°ä½¿ç”¨`Optional`å…³é”®å­—æ˜¯è¦ä½¿ç”¨è¿™æ ·çš„æ–¹æ³•ï¼šå®ƒçš„å€¼ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ä¼šäº§ç”Ÿä¸€ä¸ªå¯æ›¿ä»£ç‰©ï¼Œåªæœ‰å½“å€¼å­˜åœ¨æ—¶æ‰ä¼šä½¿ç”¨è¿™ä¸ªå€¼ã€‚

é€šå¸¸æˆ‘ä»¬å¸Œæœ›åœ¨æ²¡æœ‰ä»»ä½•åŒ¹é…æ—¶ï¼Œæˆ‘ä»¬èƒ½ç”¨æŸç§é»˜è®¤å€¼æ¥æ›¿ä»£ã€‚

```java
var optional = Optional.empty(); // åˆ›å»ºä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡
String result = (String) optional.orElse("Tom"); // æ‰“å°Tom
```

æˆ–è€…æˆ‘ä»¬ä¹Ÿå¯ä»¥è°ƒç”¨ä»£ç è®¡ç®—é»˜è®¤å€¼

```java
result = (String) optional.orElseGet(() -> "Wwh");
```

æˆ–è€…å¯ä»¥åœ¨æ²¡æœ‰å€¼çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸

```java
try {
    result = (String) optional.orElseThrow(() -> new IllegalArgumentException("å€¼ä¸ºç©º"));
} catch (IllegalArgumentException e) {
    System.out.println(e.getMessage());
}
```

## 1.7.2 æ¶ˆè´¹Optionalå€¼

ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†åœ¨ä¸å­˜åœ¨ä»»ä½•å€¼çš„æƒ…å†µä¸‹äº§ç”Ÿç›¸åº”çš„æ›¿ä»£ç‰©ã€‚å¦ä¸€æ¡ä½¿ç”¨å¯é€‰å€¼çš„ç­–ç•¥æ˜¯åªæœ‰åœ¨å…¶å­˜åœ¨çš„æƒ…å†µä¸‹æ‰æ¶ˆè´¹è¯¥å€¼ã€‚å¯ä»¥ä½¿ç”¨`ifPresent`æ–¹æ³•

```java
var optional = Optional.of(666);
optional.ifPresent(it -> System.out.println(it * 2 % 233));
```

å¦‚æœæƒ³è¦åœ¨å¯é€‰å€¼å­˜åœ¨æ—¶æ‰§è¡Œä¸€ç§æ“ä½œï¼Œç„¶ååœ¨å€¼ä¸å­˜åœ¨æ—¶æ‰§è¡Œå¦ä¸€ç§æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨`ifPresentOrElse`æ–¹æ³•

```java
optional.ifPresentOrElse(
    it -> System.out.println(it * 2 % 233), 
    () -> System.out.println("å€¼ä¸ºç©º")
);
```

## 1.7.3 ç®¡é“åŒ–Optionalå€¼

åœ¨ç¼–ç¨‹ä¸­ï¼Œç®¡é“åŒ–é€šå¸¸æŒ‡çš„æ˜¯å°†å¤šä¸ªæ“ä½œé“¾æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªæ“ä½œåºåˆ—ï¼Œå…¶ä¸­æ¯ä¸ªæ“ä½œçš„è¾“å‡ºéƒ½æ˜¯ä¸‹ä¸€ä¸ªæ“ä½œçš„è¾“å…¥ã€‚è¿™ç§æ–¹å¼å¯ä»¥ä½¿ä»£ç æ›´ç®€æ´ï¼Œæ›´æ˜“è¯»ï¼Œä¹Ÿæ›´æ˜“äºç»´æŠ¤ã€‚

ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•ä»`Optional`å¯¹è±¡ä¸­è·å–å€¼ã€‚å¦ä¸€ç§ç­–ç•¥æ˜¯ä¿æŒ`Optional`å®Œæ•´ï¼Œä½¿ç”¨`map`æ–¹æ³•è½¬æ¢`Optional`å†…éƒ¨çš„å€¼ã€‚

```java
var optional = Optional.of(666);
var result = optional.map(it -> it * 2 % 233); // 132

optional = Optional.empty();
result = optional.map(it -> it * 2 % 233); // ç»“æœä¸ºç©º
```

ç›¸ä¼¼çš„ï¼Œå¯ä»¥ä½¿ç”¨`filter`æ–¹æ³•æ¥å¤„ç†é‚£äº›åœ¨è½¬æ¢å®ƒä¹‹å‰æˆ–ä¹‹åæ»¡è¶³æŸç§ç‰¹å®šå±æ€§çš„`Optional`å€¼ã€‚

æ³¨æ„ï¼Œ`Optional`ä¸­çš„`filter`æ–¹æ³•ä¸`Stream`ä¸­ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒçš„å°ºå¯¸åªæœ‰1æˆ–0

```java
var opt = Optional.of("666www");
var res = opt.filter(it -> it.length() > 10); // ç»“æœä¸ºç©º
```

ä¹Ÿå¯ä»¥ç”¨`or`æ–¹æ³•å°†ç©ºçš„`Optional`å¯¹è±¡æ›¿æ¢ä¸ºä¸€ä¸ªå¯æ›¿ä»£çš„`Optional`ã€‚

è¿™ä¸ªå¯æ›¿ä»£å€¼å°†ä»¥æƒ°æ€§è®¡ç®—ã€‚

```java
opt = Optional.of("666www"); // 666www
```

## 1.7.4 Optionalç±»å‹æ­£ç¡®ç”¨æ³•çš„æç¤º

- Optionalç±»å‹çš„å˜é‡åº”è¯¥æ°¸è¿œä¸ä¸ºnull
- ä¸è¦åœ¨é›†åˆå’Œæ˜ å°„ä¸­ä½¿ç”¨Optionalå¯¹è±¡

## 1.7.5 åˆ›å»ºOptionalçš„å€¼

```java
var optional = Optional.of("Wwh"); // åˆ›å»ºä¸€ä¸ªéç©ºçš„Optionalå¯¹è±¡

optional = Optional.ofNullable(null); // åˆ›å»ºä¸€ä¸ªå¯èƒ½ä¸ºç©ºçš„Optionalå¯¹è±¡

optional = Optional.empty(); // åˆ›å»ºä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡
```

## 1.7.6 ç”¨flatMapæ„å»ºOptionalå€¼çš„å‡½æ•°

å‡è®¾ä½ æœ‰ä¸€ä¸ªå¯ä»¥äº§ç”Ÿ`Optional<T>`å¯¹è±¡çš„æ–¹æ³•fï¼Œå¹¶ä¸”ç›®æ ‡ç±»å‹`T`å…·æœ‰ä¸€ä¸ªå¯ä»¥äº§ç”Ÿ`Optional<U>`çš„å¯¹è±¡çš„æ–¹æ³•`g`ã€‚

å¦‚æœå®ƒä»¬éƒ½æ˜¯æ™®é€šçš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥è°ƒç”¨`s.f().g()`å°†å®ƒä»¬ç»„åˆèµ·æ¥ï¼Œä½†è¿™ç§ç»„åˆæ— æ³•å·¥ä½œï¼Œå› ä¸º`s.f()`ç±»å‹ä¸º`Optional<T>`ï¼Œè€Œä¸æ˜¯`T`ã€‚

å› æ­¤éœ€è¦è°ƒç”¨

> Optional<U> result = s.f().flatMap(T::g)

ä¸‹é¢æ˜¯ä¸ªå°†åŒç²¾åº¦æµ®ç‚¹æ•°å¹³æ–¹çš„ä¾‹å­

```java
public static void main(String[] args) {
    Optional<Double> result = f(4.0).flatMap(x -> Optional.of(x * x));
    System.out.println(result);
}

private static Optional<Double> f(Double t){
    return Optional.of(t);
}
```

å¦‚æœæœ‰æ›´å¤šçš„æ–¹æ³•ï¼Œéƒ½å¯ä»¥ç”¨`flatMap`è¿æ¥èµ·æ¥ï¼Œè¿›è€Œæ„å»ºç”±è¿™äº›æ­¥éª¤æ„å»ºçš„ç®¡é“ï¼Œåªæœ‰æ‰€æœ‰æ­¥éª¤éƒ½æˆåŠŸï¼Œè¯¥ç®¡é“æ‰ä¼šæˆåŠŸã€‚

## 1.7.7 å°†Optionalè½¬æ¢ä¸ºæµ

`stream`æ–¹æ³•ä¼šå°†`Optional<T>`å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªå…·æœ‰0ä¸ªæˆ–1ä¸ªå…ƒç´ çš„`Stream<T>`å¯¹è±¡

è¿™ä¼šä½¿è¿”å›`Optional`ç»“æœçš„æ–¹æ³•å˜å¾—å¾ˆæœ‰ç”¨ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨æˆ·IDæµå’Œå¦‚ä¸‹æ–¹æ³•

```java
private static Optional<User> lookup(String id){
    return Optional.of(new User(id));
}
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`filter`è¿‡æ»¤æ— æ•ˆ`id`

ä¾‹å¦‚ä¸‹é¢è¿™ç§æ–¹å¼

```java
Stream<User> users = list.stream().map(å°†Optionalè½¬æ¢ä¸ºæµ::lookup)
    .filter(Optional::isPresent)
    .map(Optional::get);
```

ä¸è¿‡è¿™ç§æ–¹å¼ä½¿ç”¨äº†ä¸å»ºè®®ä½¿ç”¨çš„`isPresent`å’Œ`get`æ–¹æ³•ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è°ƒç”¨æ–¹å¼

```java
Stream<User> userStream = list.stream().map(å°†Optionalè½¬æ¢ä¸ºæµ::lookup)
                .flatMap(Optional::stream);
```

# 1.8 æ”¶é›†ç»“æœ

å¤„ç†å®Œæµä¹‹åï¼Œå¯ä»¥ç”¨ä¸‹åˆ—æ–¹å¼æŸ¥çœ‹ç»“æœ

`iterator`æ–¹æ³•å¯ä»¥è·å¾—è¿­ä»£å™¨ã€‚

```java
private static void iteratoræ–¹æ³•(){
    Iterator<Integer> iterator = stream.iterator();
    while (iterator.hasNext()){
        System.out.print(iterator.next() + " ");
    }
    System.out.println();
}
```

å¯ä»¥ä½¿ç”¨`forEach`å°†æŸä¸ªå‡½æ•°åº”ç”¨äºæ¯ä¸ªå…ƒç´ 

```java
private static void forEachæ–¹æ³•(){
    Stream<Integer> stream = list.stream();
    stream.forEach(it -> System.out.print(it * 2 + " "));
    System.out.println();
}
```

åœ¨å¹¶è¡Œæµä¸Šï¼Œ`forEach`ä¼šä»¥ä»»æ„é¡ºåºéå†å„ä¸ªå…ƒç´ ã€‚

å¦‚æœæƒ³è¦æŒ‰ç…§æµä¸­é¡ºåºæ¥å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨`forEachOrdered`æ–¹æ³•ã€‚

ä¸è¿‡è¿™ä¸ªæ–¹æ³•ä¼šä¸§å¤±å¹¶è¡Œå¤„ç†çš„éƒ¨åˆ†ç”šè‡³å…¨éƒ¨ä¼˜åŠ¿ã€‚

`toArray`æ–¹æ³•å¯ä»¥è·å¾—ç”±æµçš„å…ƒç´ æ„æˆçš„æ•°ç»„ã€‚

```java
private static void toArrayæ–¹æ³•(){
    Stream<Integer> stream = list.stream();
    Object[] objects = stream.toArray();
    for (Object object : objects) {
        System.out.print(object + " ");
    }
    System.out.println();
}
```

å°†æµä¸­å…ƒç´ æ”¶é›†åˆ°å¦ä¸€ä¸ªç›®æ ‡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨`collect`æ–¹æ³•ï¼Œå®ƒä¼šæ¥æ”¶ä¸€ä¸ª`Collector`æ¥å£çš„å®ä¾‹ã€‚

æ”¶é›†å™¨æ˜¯ä¸€ç§æ”¶é›†ä¼—å¤šå…ƒç´ å¹¶äº§ç”Ÿå•ä¸€ç»“æœçš„å¯¹è±¡ã€‚

ä¸è¿‡åœ¨`Java 16`ä¸­ï¼Œå®ƒæ–°å¢äº†`toList`ç­‰æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥è½¬ä¸ºç›¸åº”å¯¹è±¡ã€‚

ä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ§åˆ¶è·å¾—é›†çš„ç§ç±»ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è°ƒç”¨ã€‚

```java
TreeSet<Integer> result1 = stream.collect(Collectors.toCollection(TreeSet::new)); // æ”¶é›†ç»“æœè½¬æ¢ä¸ºTreeSet
```

ä¹Ÿå¯ä»¥å°†æµè½¬æ¢ä¸ºå­—ç¬¦ä¸²

```java
String result2 = stream
    .map(String::valueOf)
    .collect(Collectors.joining(", ")); // æ”¶é›†ç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶ä¸”ä¸­é—´æœ‰é€—å·
```

è¿˜å¯ä»¥å°†æµçº¦ç®€ä¸ºæ€»å’Œã€æ•°é‡ã€å¹³å‡å€¼ç­‰

é€šè¿‡è°ƒç”¨result3ä¸­çš„æ–¹æ³•è·å–æ€»å’Œã€æ•°é‡ã€å¹³å‡å€¼ï¼Œæœ€å¤§å€¼ï¼Œæœ€å°å€¼

```java
IntSummaryStatistics result3 = stream
    .collect(Collectors.summarizingInt(Integer::intValue));// æ”¶é›†ç»“æœè½¬æ¢ä¸ºç»Ÿè®¡ç»“æœ
```



# 1.9 æ”¶é›†åˆ°æ˜ å°„è¡¨ä¸­

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª`Stream<Person>`

```java
class Person{
    private Long id;
    private String name;
    public Person(Long id, String name) {
        this.id = id;
        this.name = name;
    }
    public Long id() {
        return id;
    }
    public String name() {
        return name;
    }
}
```

æˆ‘ä»¬æƒ³å°†å…¶è½¬æ¢ä¸º`Map`ç±»å‹ï¼Œä½¿å¾—idå’Œåå¯¹åº”

å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼

```java
private static void Personæµè½¬æ˜ å°„è¡¨(){
    Stream<Person> personStream = Stream.of(new Person(1L, "å¼ ä¸‰"), new Person(2L, "æå››"));
    Map<Long,String> collect = personStream.collect(Collectors.toMap(Person::id, Person::name));
}
```

å¦‚æœéœ€è¦å€¼ç›´æ¥æ˜ å°„åˆ°åŸæœ¬çš„å¯¹è±¡ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼

```java
private static void Personæµè½¬æ˜ å°„è¡¨_é‡å¤é”®(){
    Stream<Person> personStream = Stream.of(new Person(1L, "å¼ ä¸‰"), new Person(1L, "æå››"));
    Map<Long,Person> collect = personStream
        .collect(Collectors.toMap(Person::id, Function.identity(),(oldValue, newValue) -> oldValue));
}
```

å…¶ä¸­`Function.identity()`è¢«ç”¨ä½œå€¼ç”Ÿæˆå™¨ï¼Œæ„å‘³ç€æ˜ å°„è¡¨çš„å€¼å°†æ˜¯åŸå§‹çš„`Person`å¯¹è±¡ï¼Œæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚

å¦‚æœæœ‰å¤šä¸ªå…ƒç´ å…·æœ‰ç›¸åŒçš„é”®ï¼Œå°±ä¼šå­˜åœ¨å†²çªï¼Œæ”¶é›†å™¨å°†ä¼šæŠ›å‡º`IllegalStateException`å¼‚å¸¸ã€‚

æˆ‘ä»¬å¯ä»¥æä¾›ç¬¬ä¸‰ä¸ªå‡½æ•°å¼•å…ƒæ¥è¦†ç›–è¿™ç§è¡Œä¸ºã€‚

è¯¥å‡½æ•°ä¼šæ ¹æ®å·²æœ‰çš„å€¼å’Œæ–°å€¼æ¥è§£å†³å†²çªå¹¶ç¡®å®šé”®å¯¹åº”çš„å€¼ã€‚

å‡è®¾æˆ‘ä»¬æƒ³è¦äº†è§£æ¯ä¸ªå›½å®¶ä¸­çš„æ‰€æœ‰è¯­è¨€ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª`Map<String,Set<String>>`ã€‚

ä¾‹å¦‚å·´è¥¿æœ‰[è¥¿ç­ç‰™è¯­, è‘¡è„ç‰™è¯­]ã€‚

æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸ºæ¯ç§è¯­è¨€å­˜å‚¨ä¸€ä¸ªå•ä¾‹é›†ï¼Œå½“æˆ‘ä»¬æ‰¾åˆ°ç»™å®šå›½å®¶çš„æ–°è¯­è¨€æ—¶ï¼Œå°†å…¶æ·»åŠ è¿›é›†åˆã€‚

```java
private static void è¯­è¨€æµè½¬æ˜ å°„è¡¨_é‡å¤é”®_åˆå¹¶() {
    Stream<Locale> availableLocales = Stream.of(Locale.getAvailableLocales());
    Map<String, Set<String>> collect = availableLocales.collect(
        Collectors.toMap(
            Locale::getDisplayCountry,
            l -> Set.of(l.getDisplayLanguage()),
            (oldValue, newValue) -> {
                Set<String> union = new HashSet<>(oldValue);
                union.addAll(newValue);
                return union;
            }
        ));
    System.out.println(collect);
}
```

è‹¥æˆ‘ä»¬æƒ³è·å–`TreeMap`ï¼Œé‚£ä¹ˆæ„é€ å™¨éœ€è¦ç¬¬å››ä¸ªå¼•å…ƒ

```java
private static void è·å–TreeMap(){
    Stream<Person> personStream = Stream.of(new Person(1L, "å¼ ä¸‰"), new Person(2L, "æå››"));
    TreeMap<Long, Person> collect = personStream
        .collect(Collectors.toMap(Person::id, Function.identity(), (oldValue, newValue) -> oldValue, TreeMap::new));
}
```

# 1.10 ç¾¤ç»„å’Œåˆ†åŒº

ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ”¶é›†äº†æ¯ä¸ªå›½å®¶ä¸­çš„æ‰€æœ‰è¯­è¨€ï¼Œä½†æ˜¯å¤„ç†æœ‰äº›å†—é•¿ã€‚

å°†å…·æœ‰ç›¸åŒç‰¹æ€§çš„å€¼ç¾¤èšæˆç»„æ˜¯éå¸¸å¸¸è§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`gropingBy`æ–¹æ³•æ¥æ”¯æŒå®ƒã€‚

```java
private static void è¯­è¨€æµè½¬æ˜ å°„è¡¨_é‡å¤é”®_åˆå¹¶_ä½¿ç”¨groupingBy() {
    Stream<Locale> availableLocales = Stream.of(Locale.getAvailableLocales());
    Map<String, Set<String>> collect = availableLocales.collect(
        Collectors.groupingBy(
            Locale::getDisplayCountry,
            Collectors.mapping(Locale::getDisplayLanguage, Collectors.toSet())
        ));
    System.out.println(collect);
}
```

å½“åˆ†ç±»å‡½æ•°æ˜¯ä¸€ä¸ª`è¿”å›booleanå€¼çš„å‡½æ•°`æ—¶ï¼Œè¿™ç§æƒ…å†µä¸‹`partitioningBy`æ›´ä¸ºé«˜æ•ˆã€‚

```java
private static void è¯­è¨€æµè½¬æ˜ å°„è¡¨_é‡å¤é”®_åˆå¹¶_ä½¿ç”¨partitioningBy() {
    Stream<Locale> availableLocales = Stream.of(Locale.getAvailableLocales());
    Map<Boolean, List<Locale>> collect = availableLocales.collect(
        Collectors.partitioningBy(l -> l.getLanguage().equals("zh")));
    System.out.println(collect.get(true));
}
```

å®ƒä¼šè¿”å›æ‰€æœ‰åœ°åŒºè¯­è¨€ç¼–ç ç­‰äº`zh`çš„è¯­è¨€

# 1.11 ä¸‹æ¸¸æ”¶é›†å™¨

`groupingBy`æ–¹æ³•ä¼šäº§ç”Ÿä¸€ä¸ªæ˜ å°„è¡¨ï¼Œå®ƒçš„æ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚

å¦‚æœæƒ³è¦å¤„ç†åˆ—è¡¨ï¼Œåˆ™éœ€è¦æä¾›ä¸€ä¸ª`ä¸‹æ¸¸æ”¶é›†å™¨`ã€‚

ä¾‹å¦‚æƒ³è·å¾—é›†è€Œä¸æ˜¯åˆ—è¡¨ï¼Œåº”è¯¥è¿™ä¹ˆå†™

```java
private static void è¯­è¨€æµè½¬æ˜ å°„è¡¨_é‡å¤é”®_åˆå¹¶_ä½¿ç”¨groupingBy() {
    Stream<Locale> availableLocales = Stream.of(Locale.getAvailableLocales());
    Map<String, Set<Locale>> collect = availableLocales.collect(
        Collectors.groupingBy(
            Locale::getCountry,
            toSet()
        ));
    System.out.println(collect);
}
```

Javaæä¾›äº†å¤šç§å¯ä»¥å°†æ”¶é›†åˆ°çš„å…ƒç´ çº¦ç®€ä¸ºæ•°å­—çš„æ”¶é›†å™¨

- `counting`ä¼šäº§ç”Ÿæ”¶é›†åˆ°çš„å…ƒç´ çš„ä¸ªæ•°

  ```java
  private static void è¯­è¨€æµè½¬æ˜ å°„è¡¨_ç»Ÿè®¡å…ƒç´ ä¸ªæ•°(){
      Stream<Locale> availableLocales = Stream.of(Locale.getAvailableLocales());
      Map<String, Long> collect = availableLocales.collect(
          Collectors.groupingBy(
              Locale::getCountry,
              Collectors.counting()
          ));
      System.out.println(collect);
  }
  ```

  å¯ä»¥å¯¹æ¯ä¸ªå›½å®¶æœ‰å¤šå°‘localeè¿›è¡Œè®¡æ•°

- `summing(Int|Long|Double)`å’Œ`averging(Int|Long|Double)`ï¼Œä¼šæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå¼•å…ƒï¼Œå°†è¯¥å‡½æ•°åº”ç”¨åˆ°ä¸‹æ¸¸å…ƒç´ ä¸Šã€‚

  ```java
  private static void è¯­è¨€æµè½¬æ˜ å°„è¡¨_ç»Ÿè®¡æ€»å’Œå’Œå¹³å‡() {
      Stream<Locale> availableLocales = Stream.of(Locale.getAvailableLocales());
      Map<String,Integer> collect = availableLocales.collect(
          Collectors.groupingBy(
              Locale::getCountry,
              summingInt(l -> l.getLanguage().length())
          ));
      System.out.println(collect);
      availableLocales = Stream.of(Locale.getAvailableLocales());
      Map<String, Double> collect1 = availableLocales.collect(
          Collectors.groupingBy(
              Locale::getCountry,
              Collectors.averagingInt(l -> l.getLanguage().length())
          ));
      System.out.println(collect1);
  }
  ```

- `maxBy`å’Œ`minBy`æ¥å—ä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œåˆ†åˆ«äº§ç”Ÿä¸‹æ¸¸å…ƒç´ ä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼

  ```java
  private static void maxByå’ŒminByæ–¹æ³•(){
      Stream<Student> studentStream = Stream.of(new Student("åŒ—äº¬", "å¼ ä¸‰"), new Student("ä¸Šæµ·", "æå››"));
      Map<String, Optional<Student>> collect = studentStream.
          collect(groupingBy(Student::getCity, maxBy(Comparator.comparing(Student::getName))));
      System.out.println(collect);
      studentStream = Stream.of(new Student("åŒ—äº¬", "å¼ ä¸‰"), new Student("ä¸Šæµ·", "æå››"));
      collect = studentStream.
          collect(groupingBy(Student::getCity, minBy(Comparator.comparing(Student::getName))));
      System.out.println(collect.get("åŒ—äº¬").get().getName());
  }
  ```

- `CollectingAndThen`æ”¶é›†å™¨ä¼šåœ¨æ”¶é›†å™¨åé¢æ·»åŠ ä¸€ä¸ªæœ€ç»ˆæ­¥éª¤ã€‚ä¾‹å¦‚æˆ‘ä»¬æƒ³çŸ¥é“æœ‰å¤šå°‘ä¸ªä¸åŒçš„ç»“æœï¼Œå¯ä»¥æ”¶é›†åˆ°é›†é‡Œå†è®¡ç®—é›†çš„å°ºå¯¸

  ```java
  private static void collectionAndThenæ–¹æ³•(){
      var list = Stream.generate(Math::random).limit(30).toList();
      Map<Character, Integer> collect = list.stream().collect(groupingBy(
          s -> String.valueOf(s + 0.5).charAt(0),
          collectingAndThen(toSet(), Set::size)
      ));
      System.out.println(collect);
  }
  ```

- `mapping`æ”¶é›†å™¨åšæ³•æ­£å¥½ç›¸åï¼Œå®ƒä¼šå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºæ”¶é›†åˆ°çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶å°†ç»“æœä¼ åˆ°ä¸‹æ¸¸æ”¶é›†å™¨

  ```java
  private static void mappingæ–¹æ³•(){
      var list = Stream.generate(Math::random).limit(30).toList();
      Map<Character, Set<Integer>> collect = list.stream().collect(
          groupingBy(
              s -> String.valueOf(s + 0.5).charAt(0),
              mapping(s -> String.valueOf(s + 0.5).length(), toSet())
          )
      );
      System.out.println(collect);
  }
  ```

- `flatMapping`æ–¹æ³•ï¼Œå¯ä»¥å°†æµæ‘Šå¹³ï¼Œå¹¶æ·»åŠ åˆ°æŒ‡å®šé›†åˆä¸­

  ```java
  private static void flatMappingæ–¹æ³•(){
      List<String> words = List.of("Hello", "World");
      Map<Integer, Set<Character>> result = words.stream()
          .collect(Collectors.groupingBy(
              String::length,
              Collectors.flatMapping(
                  word -> word.chars().mapToObj(c -> (char) c),
                  Collectors.toSet()
              )
          ));
  }
  ```

- `summarizingInt`ç­‰æ–¹æ³•å¯ä»¥è·å–å‡½æ•°çš„æ€»å’Œï¼Œå¹³å‡å€¼ï¼Œæœ€å¤§æœ€å°å€¼ï¼Œæ•°é‡

  ```java
  private static void summarizingæ–¹æ³•(){
      var list = Stream.generate(Math::random).limit(30).toList();
      Map<Character, DoubleSummaryStatistics> collect = list.stream().collect(groupingBy(
          s -> String.valueOf(s + 0.3).charAt(0),
          summarizingDouble(Double::valueOf)
      ));
      System.out.println(collect);
  }
  ```

- `filtering`æ”¶é›†å™¨ä¼šå°†è¿‡æ»¤å™¨åº”ç”¨åˆ°æ¯ä¸ªç»„ä¸Š

  ```java
  private static void filteringæ–¹æ³•(){
      var list = Stream.generate(Math::random).limit(30).toList();
      Map<Character, DoubleSummaryStatistics> collect = list.stream().collect(groupingBy(
          s -> String.valueOf(s + 0.3).charAt(0),
          filtering(s -> s>0.5,summarizingDouble(Double::valueOf))
      ));
      System.out.println(collect);
  }
  ```

# 1.12 çº¦ç®€æ“ä½œ

  `reduceæ–¹æ³•`æ˜¯ä¸€ç§ç”¨äºä»æµä¸­è®¡ç®—æŸä¸ªå€¼çš„é€šç”¨æœºåˆ¶ï¼Œæœ€ç®€å•çš„å½¢å¼æ˜¯æ¥å—ä¸€ä¸ªäºŒå…ƒå‡½æ•°ï¼Œå¹¶ä»å‰ä¸¤ä¸ªå…ƒç´ æŒç»­åº”ç”¨ã€‚

  ```java
  private static void ç®€å•reduceæ–¹æ³•(){
      List<Integer> list = Stream.generate(() -> random.nextInt(15)).limit(30).toList();
      Optional<Integer> reduce = list.stream().reduce(Integer::sum);
      reduce.ifPresent(System.out::println);
  }
  ```

  å¦‚æœæµä¸ºç©ºï¼Œä¼šè¿”å›ä¸€ä¸ª`Optional`ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•æœ‰æ•ˆçš„ç»“æœã€‚

  å¦‚æœè¦ç”¨å¹¶è¡Œæµæ¥çº¦ç®€ï¼Œé‚£ä¹ˆè¿™é¡¹çº¦ç®€æ“ä½œå¿…é¡»æ˜¯å¯ç»“åˆçš„ï¼Œå³ç»„åˆå…ƒç´ æ—¶ä½¿ç”¨çš„é¡ºåºä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ã€‚

  å³$(x~op~y)~op~z = x~op~(y~op~z) $

  é€šå¸¸æˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªå¹ºå…ƒå€¼eä½¿å¾—$e~op~ x = x$ï¼Œä½œä¸ºå…ƒç´ çš„èµ·ç‚¹ã€‚

  ```java
  private static void æŒ‡å®šå¹ºå…ƒå€¼reduceæ–¹æ³•(){
      List<Integer> list = Stream.generate(() -> random.nextInt(15)).limit(30).toList();
      Integer result = list.stream().reduce(0,Integer::sum);
      System.out.println(result);
  }
  ```

è¿™ç§æƒ…å†µä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸ç”¨ä½¿ç”¨`Optional`ç±»äº†ã€‚

å½“æœ‰æ—¶ä½ éœ€è¦å¯¹æŸäº›å±æ€§æ±‚å’Œï¼Œä¾‹å¦‚å­—ç¬¦ä¸²æµä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ç®€å•åœ°ä½¿ç”¨`reduce`,è¿˜éœ€è¦æä¾›ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†ç»“æœ

```java
Long result = limit.reduce(0L,Long::sum,Long::sum);
```

è¿™ç§æƒ…å†µä¸‹ä¸º`reduce`æä¾›ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥åˆå¹¶å®ƒä»¬çš„ç»“æœã€‚

# 1.13 åŸºæœ¬ç±»å‹æµ

ç›®å‰ä¸ºæ­¢æ‰€æœ‰æµä¸­çš„å…ƒç´ éƒ½æ˜¯å¯¹è±¡ï¼Œä½†æ˜¯å°†æ¯ä¸ªå…ƒç´ éƒ½åŒ…è£…åˆ°å¯¹è±¡ä¸­æ˜¯éå¸¸ä½æ•ˆçš„ã€‚

æœ‰ä¸‰ç§æµå¯ä»¥ç›´æ¥å­˜å‚¨åŸºæœ¬ç±»å‹

`IntStream`å­˜å‚¨`short`ã€`char`ã€`byte`ã€`boolean`

`DoubleStream`å­˜å‚¨`float`

æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼åˆ›å»ºæµ

```java
private static void åŸºæœ¬ç±»å‹æµ(){
    IntStream intStream = IntStream.of(1,2,3,4,5);
    intStream = Arrays.stream(new int[]{1,2,3,4,5});
}
```

ä¸å¯¹è±¡æµç›¸åŒ,å¯ä»¥ä½¿ç”¨`generate`å’Œ`iterate`

`InStream`æœ‰`range`å’Œ`rangeClosed`æ–¹æ³•å¯ä»¥ç”Ÿæˆæ­¥é•¿ä¸º1çš„æ•´æ•°èŒƒå›´

```java
private static void rangeå’ŒrangeClosedæ–¹æ³•(){
    IntStream range = IntStream.range(0, 100); // ä¸åŒ…æ‹¬ä¸Šé™
    range.forEach(System.out::println);
    range = IntStream.rangeClosed(0,100); // åŒ…æ‹¬ä¸Šé™
    range.forEach(System.out::println);
}
```

å½“æœ‰ä¸€ä¸ªåŸºæœ¬æµæ—¶ï¼Œå¯ä»¥ä½¿ç”¨`box`å°†å…¶åŒ…è£…ä¸ºå¯¹è±¡æµ

```java
private static void boxedæ–¹æ³•(){
    IntStream range = IntStream.rangeClosed(1,100);
    Stream<Integer> boxed = range.boxed();
}
```

å¯ä»¥ç”¨`mapToInt`æ–¹æ³•å†å°†å¯¹è±¡æµè½¬ä¸ºåŸºæœ¬æµ

```java
range = boxed.mapToInt(Integer::intValue);
```







